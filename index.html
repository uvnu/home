<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UV.nu ‚Äì UV Index i Sverige</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f9f9f9; }
header { display:flex; justify-content: space-between; align-items:center; padding: 1rem; background:#0066cc; color:white; }
header .lang-toggle { cursor:pointer; font-size:1.2rem; }
main { max-width:600px; margin:2rem auto; padding:1rem; background:white; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
h1 { font-size:1.5rem; text-align:center; }
.search-container { position:relative; margin:1rem 0; }
input[type="text"] { width:100%; padding:0.8rem; font-size:1rem; border-radius:4px; border:1px solid #ccc; }
input:focus { outline: 2px solid #0066cc; }
.suggestions { position:absolute; top:100%; left:0; right:0; background:white; border:1px solid #ccc; max-height:200px; overflow-y:auto; z-index:100; display:none; }
.suggestion-item { padding:0.5rem; cursor:pointer; }
.suggestion-item:hover { background:#eee; }
.uv-display { text-align:center; margin:2rem 0; padding:1rem 2rem; border-radius:50px; color:white; font-weight:bold; font-size:1.5rem; display:inline-block; }
.uv-low { background: linear-gradient(to right, #4caf50, #81c784); }
.uv-moderate { background: linear-gradient(to right, #ffeb3b, #fff176); color:#333; }
.uv-high { background: linear-gradient(to right, #ff9800, #ffb74d); }
.uv-veryhigh { background: linear-gradient(to right, #f44336, #e57373); }
.uv-extreme { background: linear-gradient(to right, #9c27b0, #ba68c8); }
.recommendations { margin-top:1rem; line-height:1.5; }
.forecast-container { margin-top:2rem; }
.forecast-bar { display:flex; align-items:center; margin:0.3rem 0; }
.forecast-time { width:50px; font-size:0.9rem; }
.forecast-bar-fill { height:20px; border-radius:10px; flex:1; margin-left:10px; }
footer { text-align:center; font-size:0.8rem; padding:1rem; margin-top:2rem; color:#555; }
</style>
</head>
<body>

<header>
  <div>UV.nu</div>
  <div class="lang-toggle" onclick="toggleLang()">üá∏üá™</div>
</header>

<main>
  <h1 id="title">UV-index i <span id="selected-city">V√§lj stad</span></h1>
  
  <div class="search-container">
    <input type="text" id="city-input" placeholder="Skriv stad eller v√§lj">
    <div class="suggestions" id="suggestions"></div>
  </div>

  <div id="uv-info">
    <div class="uv-display" id="uv-display" style="display:none;">‚òÄÔ∏è UV-index</div>
    <div class="recommendations" id="recommendations"></div>
    <div class="forecast-container" id="forecast-container"></div>
  </div>
</main>

<footer>
  <div>¬© 2025 UV.nu | <a href="#">Mer info om UV-str√•lning</a></div>
  <div style="margin-top:1rem;">H√§r kan en diskret annons visas</div>
</footer>

<script>
// ------------------- LANGUAGE -------------------
let lang = 'sv';
const texts = {
  sv: {
    low: "L√•g risk: Ingen s√§rskild solskydds√•tg√§rd beh√∂vs under korta stunder ute.",
    moderate: "M√•ttlig risk: Anv√§nd solskydd, hatt och skugga under soliga timmar.",
    high: "H√∂g risk: Solskydd SPF 30+, hatt, skugga mellan 10‚Äì16.",
    veryhigh: "Mycket h√∂g risk: Extra solskydd, minimera direkt exponering mitt p√• dagen.",
    extreme: "Extrem risk: Undvik solen mitt p√• dagen, SPF 50+, kl√§der, hatt, skugga.",
  },
  en: {
    low: "Low risk: No special sun protection needed for short periods outside.",
    moderate: "Moderate risk: Use sunscreen, hat, and seek shade during sunny hours.",
    high: "High risk: SPF 30+ sunscreen, hat, shade between 10AM‚Äì4PM.",
    veryhigh: "Very high risk: Extra protection, minimize direct exposure at midday.",
    extreme: "Extreme risk: Avoid sun at midday, SPF 50+, clothing, hat, shade.",
  }
};

function toggleLang() {
  lang = lang === 'sv' ? 'en' : 'sv';
  document.querySelector('.lang-toggle').textContent = lang === 'sv' ? 'üá∏üá™' : 'üá¨üáß';
  updateRecommendations();
  if(currentUV) displayUV(currentUV);
}

// ------------------- CITIES -------------------
const defaultCities = ["Stockholm", "G√∂teborg", "Malm√∂"];
const cityInput = document.getElementById("city-input");
const suggestionsDiv = document.getElementById("suggestions");
const selectedCitySpan = document.getElementById("selected-city");

let currentUV = null;

cityInput.addEventListener("focus", () => {
  showSuggestions(defaultCities);
});

cityInput.addEventListener("input", () => {
  const query = cityInput.value.trim();
  if (!query) return showSuggestions(defaultCities);
  fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=SE&q=${encodeURIComponent(query)}&limit=10`)
    .then(res => res.json())
    .then(data => {
      const names = data.map(c => c.display_name.split(",")[0]);
      showSuggestions(names);
    })
    .catch(err => console.error(err));
});

function showSuggestions(list) {
  suggestionsDiv.innerHTML = "";
  if (!list.length) { suggestionsDiv.style.display="none"; return; }
  list.forEach(city => {
    const div = document.createElement("div");
    div.classList.add("suggestion-item");
    div.textContent = city;
    div.addEventListener("click", () => selectCity(city));
    suggestionsDiv.appendChild(div);
  });
  suggestionsDiv.style.display = "block";
}

function selectCity(city) {
  selectedCitySpan.textContent = city;
  cityInput.value = "";
  suggestionsDiv.style.display = "none";
  fetchUV(city);
}

// ------------------- UV FETCH -------------------
function fetchUV(city) {
  fetch(`https://nominatim.openstreetmap.org/search?format=json&countrycodes=SE&q=${encodeURIComponent(city)}&limit=1`)
    .then(res => res.json())
    .then(data => {
      if (!data[0]) return alert(lang==='sv'?"Kunde inte hitta staden":"City not found");
      const lat = data[0].lat;
      const lon = data[0].lon;
      fetch(`https://api.met.no/weatherapi/uv/2.0/forecast?lat=${lat}&lon=${lon}`, {
        headers: { "User-Agent": "UV.nu example" }
      })
      .then(res => res.json())
      .then(data => {
        const ts = data?.properties?.timeseries;
        if (!ts || !ts.length) return alert(lang==='sv'?"Ingen UV-data tillg√§nglig":"No UV data available");
        const uv = ts[0].data.instant.details.uv_index_clear_sky;
        currentUV = uv;
        displayUV(uv);
        displayForecast(ts.slice(0,12));
      });
    });
}

// ------------------- UV DISPLAY -------------------
const uvDisplay = document.getElementById("uv-display");
const recommendationsDiv = document.getElementById("recommendations");
const forecastContainer = document.getElementById("forecast-container");

function displayUV(uv) {
  let level = "", colorClass="";
  if (uv <= 2) { level = "low"; colorClass="uv-low"; }
  else if (uv <= 5) { level="moderate"; colorClass="uv-moderate"; }
  else if (uv <= 7) { level="high"; colorClass="uv-high"; }
  else if (uv <= 10) { level="veryhigh"; colorClass="uv-veryhigh"; }
  else { level="extreme"; colorClass="uv-extreme"; }

  uvDisplay.textContent = `‚òÄÔ∏è ${lang==='sv'?'UV-index':'UV Index'}: ${uv} (${level.toUpperCase()})`;
  uvDisplay.className = `uv-display ${colorClass}`;
  uvDisplay.style.display="block";
  updateRecommendations(level);
}

// ------------------- FORECAST -------------------
function displayForecast(timeseries) {
  forecastContainer.innerHTML = "";
  timeseries.forEach(ts => {
    const dt = new Date(ts.time);
    const hour = dt.getHours().toString().padStart(2,'0') + ":00";
    const uv = ts.data.instant.details.uv_index_clear_sky;
    const bar = document.createElement("div");
    bar.className="forecast-bar";

    const timeDiv = document.createElement("div");
    timeDiv.className="forecast-time";
    timeDiv.textContent = hour;

    const fillDiv = document.createElement("div");
    fillDiv.className="forecast-bar-fill";
    fillDiv.style.width = Math.min(uv*10,100) + "%"; // scale bar
    let colorClass="";
    if (uv <= 2) colorClass="uv-low";
    else if (uv <= 5) colorClass="uv-moderate";
    else if (uv <= 7) colorClass="uv-high";
    else if (uv <= 10) colorClass="uv-veryhigh";
    else colorClass="uv-extreme";
    fillDiv.className = "forecast-bar-fill " + colorClass;
    fillDiv.textContent = uv;

    bar.appendChild(timeDiv);
    bar.appendChild(fillDiv);
    forecastContainer.appendChild(bar);
  });
}

// ------------------- RECOMMENDATIONS -------------------
function updateRecommendations(level=null) {
  if(!level) { recommendationsDiv.innerHTML=""; return; }
  recommendationsDiv.textContent = texts[lang][level];
}

// ------------------- HIDE SUGGESTIONS ON OUTSIDE CLICK -------------------
document.addEventListener("click", (e) => {
  if (!suggestionsDiv.contains(e.target) && e.target !== cityInput) {
    suggestionsDiv.style.display = "none";
  }
});
</script>

</body>
</html>
